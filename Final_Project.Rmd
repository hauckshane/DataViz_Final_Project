---
title: "Final Project"
author: "Shane Hauck"
date: '2022-03-21'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(fmsb)
library(scales)
library(plotly)
library(highcharter)
options(highcharter.theme = hc_theme_smpl(tooltip = list(valueDecimals = 2)))
```

```{r}
epl_standard <- read_csv("data/epl_standard.csv") %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel)) %>%
  select(-c(`Gls/90`, `Ast/90`, `G+A/90`, `G-PK/90`, `G+A-PK/90`, `xG/90`, `xA/90`, `xG+xA/90`, `npxG/90`, `npxG+xA/90`)) %>% 
  mutate(`G+A` = Gls + Ast)
epl_standard

epl_standard_90 <- read_csv("data/epl_standard_90.csv") %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel)) 
epl_standard_90
```

```{r}
epl_standard %>% 
  summarise(`25perc_90s` = quantile(`90s`, c(0.25)))
```


```{r}
epl_shooting <- read_csv("data/epl_shooting.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel)) %>%
  select(-c(`Sh/90`, `SoT/90`))
epl_shooting

epl_shooting_90 <- read_csv("data/epl_shooting_90.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel)) %>%
  select(-c(`Sh/90`, `SoT/90`))
epl_shooting_90

epl_shooting_max <- epl_shooting %>% 
  drop_na() %>%
  filter(`90s` >= 4) %>% 
  summarise_if(is.numeric, max)
epl_shooting_min <- epl_shooting %>% 
  drop_na() %>%
  filter(`90s` >= 4) %>%
  summarise_if(is.numeric, min) 

epl_shoot_player <- epl_shooting %>% filter(Name == "Marcus Rashford")

epl_shooting_max_min <- bind_rows(epl_shooting_max, epl_shooting_min)

shoot_swap <- epl_shooting_max_min %>% select(`G-xG`, `np:G-xG`) %>% 
  summarise(newMax1 = min(`G-xG`),
         newMin1 = max(`G-xG`),
         newMin2 = max(`np:G-xG`),
         newMax2 = min(`np:G-xG`))

epl_shoot_full <- bind_cols(epl_shooting_max_min, shoot_swap) %>%
  mutate(`G-xG` = if_else(`G-xG` == newMin1,
                          true = newMax1,
                          false = newMin1),
         `np:G-xG` = if_else(`np:G-xG` == newMin2,
                              true = newMax2,
                              false = newMin2)) %>%
  bind_rows(epl_shoot_player) %>%
  select(-c(Age, Squad, Pos, Nation, Name, Rk, Born, `90s`, FK, PKatt, PK, newMax1, newMin1, newMin2, newMax2))


radarchart(epl_shoot_full, pcol= "green", pfcol = rgb(0.2,0.5,0.5,0.75), 
            cglty = 1, axislabcol = "red", cglwd = 1,
           vlcex =0.8)


epl_shooting_90_max <- epl_shooting_90 %>% 
  drop_na() %>%
  filter(`90s` >= 4) %>% 
  summarise_if(is.numeric, max )
epl_shooting_90_min <- epl_shooting_90 %>% 
  drop_na() %>%
  filter(`90s` >= 4) %>%
  summarise_if(is.numeric, min) 

epl_shoot_90_player <- epl_shooting_90 %>% filter(Name == "Marcus Rashford")



epl_shoot_90_half <- full_join(epl_shooting_90_min, epl_shoot_90_player)
epl_shoot_90_full <- full_join(epl_shooting_90_max, epl_shoot_90_half) %>%
  select(-c(Age, Squad, Pos, Nation, Name, Rk, Born, `90s`, FK, PKatt, PK))


radarchart(epl_shoot_90_full, pcol= "green", pfcol = rgb(0.2,0.5,0.5,0.75), 
            cglty = 1, axislabcol = "red", cglwd = 1,
           vlcex =0.8)
```


```{r}
epl_passing <- read_csv("data/epl_passing.csv") %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_passing 

epl_passing_90 <- read_csv("data/epl_passing_90.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_passing_90 
```

```{r}
epl_passtype <- read_csv("data/epl_passtypes.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_passtype

epl_passtype_90 <- read_csv("data/epl_passtypes_90.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_passtype_90
```

```{r}
epl_goalandshotcreation <- read_csv("data/epl_goalandshotcreation.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_goalandshotcreation 

epl_goalandshotcreation_90 <- read_csv("data/epl_goalandshotcreation_90.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_goalandshotcreation_90 
```
 
```{r}
epl_passing_fill <- left_join(epl_passing, epl_passtype)
epl_passing_comb <- left_join(epl_passing_fill, epl_goalandshotcreation) %>%
  rename(`1/3` = `3-Jan`) %>%
  mutate(SCA_passes = SCA_PassLive + SCA_PassDead,
         GCA_passes = GCA_PassLive + GCA_PassDead)

epl_passing_main <- epl_passing_comb %>% 
  select(c(1:11, 14,16,17,19,20,22:24, 26:28,30,35:38, 72,73))

epl_passing_main_max <- epl_passing_main %>% 
  drop_na() %>%
  filter(`90s` >= 4,
         Pos != "GK") %>% 
  summarise_if(is.numeric, max)
epl_passing_main_min <- epl_passing_main %>% 
  drop_na() %>%
  filter(`90s` >= 4,
         Pos != "GK") %>%
  summarise_if(is.numeric, min)

epl_pass_player <- epl_passing_main %>% filter(Name == "Joao Cancelo")

epl_passing_main_max_min <- bind_rows(epl_passing_main_max, epl_passing_main_min)

epl_pass_full <-bind_rows(epl_passing_main_max_min, epl_pass_player) %>%
  select(-c(Age, Squad, Pos, Nation, Name, Rk, Born, `90s`))

epl_pass_full_scaled <- epl_pass_full %>% mutate(type = c("max", "min","player")) %>%
  pivot_longer(c(1:21), names_to = "variable", values_to = "value") %>%
  group_by(variable) %>%
  mutate(value.scaled = (value - min(value)) / (max(value) - min(value))) %>%
  filter(type == "player") %>%
  pivot_wider(names_from = variable, values_from = value.scaled) %>%
  pivot_longer(c(3:23), names_to = "variable", values_to = "value.scaled") %>%
  filter(!is.na(value.scaled)) %>%
  arrange(match(variable, c("Cmp Total", 
                            "Att Total",
                            "Cmp% Total",
                            "Cmp Short",
                            "Cmp% Short",
                            "Cmp Medium",
                            "Cmp% Medium",
                            "Cmp Long",
                            "Cmp% Long",
                            "Prog",
                            "Sw",
                            "Press",
                            "TB",
                            "1/3",
                            "PPA",
                            "Crs",
                            "KP",
                            "SCA_passes",
                            "GCA_passes",
                            "xA",
                            "Ast")))
  

passing_plot <- highchart() %>%
  hc_chart(polar = TRUE, backgroundColor = "lightgrey") %>%
  hc_add_series(data = epl_pass_full_scaled, 
                mapping = hcaes(x = variable, y = value.scaled), 
                type = "column",
                color = rgb(0,255,100, maxColorValue = 255),
                tooltip = list(pointFormat = "{point.variable}: {point.value}"),
                showInLegend = FALSE) %>%
  hc_xAxis(categories = epl_pass_full_scaled$variable) %>%
  hc_yAxis(visible = FALSE,
           max = 1) %>%
  hc_title(text = epl_pass_player$Name,
           align = "center") %>%
  hc_subtitle(text = epl_pass_player$Squad,
              align = "center")
passing_plot
```


```{r}
epl_passing_90_fill <- left_join(epl_passing_90, epl_passtype_90)
epl_passing_90_comb <- left_join(epl_passing_90_fill, epl_goalandshotcreation_90) %>%
  rename(`1/3` = `3-Jan`) %>%
  mutate(SCA_passes = SCA_PassLive + SCA_PassDead,
         GCA_passes = GCA_PassLive + GCA_PassDead)

epl_passing_90_main <- epl_passing_90_comb %>% 
  select(c(1:11, 14,16,17,19,20, 22:24, 26:28,30,35:38, 72,73))

epl_passing_90_main_max <- epl_passing_90_main %>% 
  drop_na() %>%
  filter(`90s` >= 4,
         Pos != "GK") %>% 
  summarise_if(is.numeric, max)
epl_passing_90_main_min <- epl_passing_90_main %>% 
  drop_na() %>%
  filter(`90s` >= 4,
         Pos != "GK") %>%
  summarise_if(is.numeric, min)

epl_pass_90_player <- epl_passing_90_main %>% filter(Name == "Trent Alexander-Arnold")

epl_passing_90_main_max_min <- bind_rows(epl_passing_90_main_max, epl_passing_90_main_min)

epl_pass_90_full <-bind_rows(epl_passing_90_main_max_min, epl_pass_90_player) %>%
  select(-c(Age, Squad, Pos, Nation, Name, Rk, Born, `90s`))

epl_pass_90_full_scaled <- epl_pass_90_full %>% mutate(type = c("max", "min","player")) %>%
  pivot_longer(c(1:21), names_to = "variable", values_to = "value") %>%
  group_by(variable) %>%
  mutate(value.scaled = (value - min(value)) / (max(value) - min(value))) %>%
  filter(type == "player") %>%
  pivot_wider(names_from = variable, values_from = value.scaled) %>%
  pivot_longer(c(3:23), names_to = "variable", values_to = "value.scaled") %>%
  filter(!is.na(value.scaled)) %>%
  arrange(match(variable, c("Cmp Total", 
                            "Att Total",
                            "Cmp% Total",
                            "Cmp Short",
                            "Cmp% Short",
                            "Cmp Medium",
                            "Cmp% Medium",
                            "Cmp Long",
                            "Cmp% Long",
                            "Prog",
                            "Sw",
                            "Press",
                            "TB",
                            "1/3",
                            "PPA",
                            "Crs",
                            "KP",
                            "SCA_passes",
                            "GCA_passes",
                            "xA",
                            "Ast")))
  

passing_90_plot <- highchart() %>%
  hc_chart(polar = TRUE, backgroundColor = "lightgrey") %>%
  hc_add_series(data = epl_pass_90_full_scaled, 
                mapping = hcaes(x = variable, y = value.scaled), 
                type = "column",
                color = rgb(0,255,100, maxColorValue = 255),
                tooltip = list(pointFormat = "{point.variable}: {point.value}"),
                showInLegend = FALSE) %>%
  hc_xAxis(categories = epl_pass_full_scaled$variable) %>%
  hc_yAxis(visible = FALSE,
           max = 1) %>%
  hc_title(text = epl_pass_90_player$Name,
           align = "center") %>%
  hc_subtitle(text = epl_pass_90_player$Squad,
              align = "center")
passing_90_plot
```




```{r}
epl_defensiveactions <- read_csv("data/epl_defensiveactions.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_defensiveactions

epl_defensiveactions_90 <- read_csv("data/epl_defensiveactions_90.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_defensiveactions_90
``` 

```{r}
epl_def_main <- epl_defensiveactions %>% 
  mutate(`TklsW%` = TklsW / Tkls * 10,
         `TklsW%` = as.numeric(format(round(`TklsW%`, 2)))) %>%
  select(c(1:14, 16, 18:23, 25, 27, 28, 30, 32))
  

epl_def_main_max <- epl_def_main %>% 
  drop_na() %>%
  filter(`90s` >= 4,
         Pos != "GK") %>% 
  summarise_if(is.numeric, max)
epl_def_main_min <- epl_def_main %>% 
  drop_na() %>%
  filter(`90s` >= 4,
         Pos != "GK") %>%
  summarise_if(is.numeric, min)

epl_def_player <- epl_def_main %>% filter(Name == "Declan Rice")

epl_def_main_max_min <- bind_rows(epl_def_main_max, epl_def_main_min)

epl_def_full <-bind_rows(epl_def_main_max_min, epl_def_player) %>%
  select(-c(Age, Squad, Pos, Nation, Name, Rk, Born, `90s`)) 

epl_def_full_scaled <- epl_def_full %>% mutate(type = c("max", "min","player")) %>%
  pivot_longer(c(1:18), names_to = "variable", values_to = "value") %>%
  group_by(variable) %>%
  mutate(value.scaled = (value - min(value)) / (max(value) - min(value))) %>%
  filter(type == "player") %>%
  pivot_wider(names_from = variable, values_from = value.scaled) %>%
  pivot_longer(c(3:20), names_to = "variable", values_to = "value.scaled") %>%
  filter(!is.na(value.scaled)) %>%
  arrange(match(variable, c("Tkls",
                            "TklsW",
                            "TklsW%",
                            "Tkls vs Drib",
                            "Tkl% vs Drib",
                            "Tkls Att 3rd",
                            "Tkls Mid 3rd",
                            "TKls Def 3rd",
                            "Press",
                            "Succ Press",
                            "Press%",
                            "Press Att 3rd",
                            "Press Mid 3rd",
                            "Press Def 3rd",
                            "Clr",
                            "Blocked Sh",
                            "Blocked Pass",
                            "Int")))
 
  

def_plot <- highchart() %>%
  hc_chart(polar = TRUE, backgroundColor = "lightgrey") %>%
  hc_add_series(data = epl_def_full_scaled, 
                mapping = hcaes(x = variable, y = value.scaled), 
                type = "column",
                color = rgb(0,255,100, maxColorValue = 255),
                tooltip = list(pointFormat = "{point.variable}: {point.value}"),
                showInLegend = FALSE) %>%
  hc_xAxis(categories = epl_def_full_scaled$variable) %>%
  hc_yAxis(visible = FALSE,
           max = 1) %>%
  hc_title(text = epl_def_player$Name,
           align = "center") %>%
  hc_subtitle(text = epl_def_player$Squad,
              align = "center")
def_plot
```

```{r}
epl_def_90_main <- epl_defensiveactions_90 %>% 
  mutate(`TklsW%` = TklsW / Tkls * 10,
         `TklsW%` = as.numeric(format(round(`TklsW%`, 2)))) %>%
  select(c(1:14, 16, 18:23, 25, 27, 28, 30, 32))
  

epl_def_90_main_max <- epl_def_90_main %>% 
  drop_na() %>%
  filter(`90s` >= 4.01,
         Pos != "GK") %>% 
  summarise_if(is.numeric, max)
epl_def_90_main_min <- epl_def_90_main %>% 
  drop_na() %>%
  filter(`90s` >= 4,
         Pos != "GK") %>%
  summarise_if(is.numeric, min)

epl_def_90_player <- epl_def_90_main %>% filter(Name == "Declan Rice")

epl_def_90_main_max_min <- bind_rows(epl_def_90_main_max, epl_def_90_main_min)

epl_def_90_full <-bind_rows(epl_def_90_main_max_min, epl_def_90_player) %>%
  select(-c(Age, Squad, Pos, Nation, Name, Rk, Born, `90s`)) 

epl_def_90_full_scaled <- epl_def_90_full %>% mutate(type = c("max", "min","player")) %>%
  pivot_longer(c(1:18), names_to = "variable", values_to = "value") %>%
  group_by(variable) %>%
  mutate(value.scaled = (value - min(value)) / (max(value) - min(value))) %>%
  filter(type == "player") %>%
  pivot_wider(names_from = variable, values_from = value.scaled) %>%
  pivot_longer(c(3:20), names_to = "variable", values_to = "value.scaled") %>%
  filter(!is.na(value.scaled)) %>%
  arrange(match(variable, c("Tkls",
                            "TklsW",
                            "TklsW%",
                            "Tkls vs Drib",
                            "Tkl% vs Drib",
                            "Tkls Att 3rd",
                            "Tkls Mid 3rd",
                            "TKls Def 3rd",
                            "Press",
                            "Succ Press",
                            "Press%",
                            "Press Att 3rd",
                            "Press Mid 3rd",
                            "Press Def 3rd",
                            "Clr",
                            "Blocked Sh",
                            "Blocked Pass",
                            "Int")))
 
  

def_90_plot <- highchart() %>%
  hc_chart(polar = TRUE, backgroundColor = "lightgrey") %>%
  hc_add_series(data = epl_def_90_full_scaled, 
                mapping = hcaes(x = variable, y = value.scaled), 
                type = "column",
                color = rgb(0,255,100, maxColorValue = 255),
                tooltip = list(pointFormat = "{point.variable}: {point.value}"),
                showInLegend = FALSE) %>%
  hc_xAxis(categories = epl_def_full_scaled$variable) %>%
  hc_yAxis(visible = FALSE,
           max = 1) %>%
  hc_title(text = epl_def_90_player$Name,
           align = "center") %>%
  hc_subtitle(text = epl_def_90_player$Squad,
              align = "center")
def_90_plot
```


```{r}
epl_possesion <- read_csv("data/epl_possesion.csv", skip = 1) %>%
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_possesion

epl_possesion_90 <- read_csv("data/epl_possesion_90.csv", skip = 1) %>%
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_possesion_90
```

```{r}
epl_miscellaneous <- read_csv("data/epl_miscellaneous.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_miscellaneous

epl_miscellaneous_90 <- read_csv("data/epl_miscellaneous_90.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_miscellaneous_90
```

```{r}
epl_goalkeeper <- read_csv("data/epl_goalkeeper.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_goalkeeper

epl_goalkeeper_90 <- read_csv("data/epl_goalkeeper_90.csv", skip = 1) %>% 
  select(-c(Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_goalkeeper_90
```

```{r}
epl_goalkeeperadvanced <- read_csv("data/epl_goalkeeperadvanced.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_goalkeeperadvanced

epl_goalkeeperadvanced_90 <- read_csv("data/epl_goalkeeperadvanced_90.csv", skip = 1) %>% 
  select(-c(Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_goalkeeperadvanced_90
```
















```{r}
epl_standard_player <- epl_standard %>% filter(Name == "Max Aarons")

epl_standard_max <- epl_standard %>% summarise_if(is.numeric, max)
epl_standard_min <- epl_standard %>% summarise_if(is.numeric, min)

epl_standard_half <- full_join(epl_standard_min, epl_standard_player)
epl_standard_full <- full_join(epl_standard_max, epl_standard_half) %>%
  select(-c(Born, Name, Nation, Pos, Squad, Age))


radarchart(epl_standard_full, pcol= "green", pfcol = rgb(0.2,0.5,0.5,0.75), 
            cglty = 1, axislabcol = "red", cglwd = 1,
           vlcex =0.8)
```








```{r}
epl_standard_player <- epl_standard %>% filter(Name == "Ivan Toney" | Name == "Max Aarons") 

epl_standard_max <- epl_standard %>% summarise_if(is.numeric, max)
epl_standard_min <- epl_standard %>% summarise_if(is.numeric, min)

epl_standard_half <- full_join(epl_standard_min, epl_standard_player)
epl_standard_full <- full_join(epl_standard_max, epl_standard_half) %>%
  select(-c(Born, Name, Nation, Pos, Squad, Age))


radarchart(epl_standard_full)
```


```{r}
library(shiny)

ui <- fluidPage(
  sidebarLayout(sidebarPanel(
    selectizeInput("playerchoice",
                   label = "Choose a Player",
                   choices = levels(factor(epl_standard$Name)))
    
  ),
  mainPanel(plotOutput("radarChart"))
  )
)

server <- function(input, output, session) {
  
  epl_standard_player <- 
    reactive({
      epl_standard %>% filter(Name == input$playerchoice)
    })
  
  epl_standard_half <- 
    reactive({
      full_join(epl_standard_min, epl_standard_player())
    })
  
  epl_standard_full <- 
    reactive({
      full_join(epl_standard_max, epl_standard_half()) %>%
        select(-c(Born, Name, Nation, Pos, Squad, Age))
    })
  
  radar_chart <- 
    reactive({
      radarchart(epl_standard_full())
    })
  
  output$radarChart <- renderPlot({
    radar_chart()
  })
}

shinyApp(ui, server)

```






