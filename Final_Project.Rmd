---
title: "Final Project"
author: "Shane Hauck"
date: '2022-03-21'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(fmsb)
```

```{r}
epl_standard <- read_csv("data/epl_standard.csv") %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel)) %>%
  select(-c(`Gls/90`, `Ast/90`, `G+A/90`, `G-PK/90`, `G+A-PK/90`, `xG/90`, `xA/90`, `xG+xA/90`, `npxG/90`, `npxG+xA/90`)) %>% 
  mutate(`G+A` = Gls + Ast)
epl_standard

epl_standard_90 <- read_csv("data/epl_standard_90.csv") %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel)) 
epl_standard_90
```

```{r}
epl_standard %>% 
  summarise(`25perc_90s` = quantile(`90s`, c(0.25)))
```


```{r}
epl_shooting <- read_csv("data/epl_shooting.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel)) %>%
  select(-c(`Sh/90`, `SoT/90`))
epl_shooting

epl_shooting_90 <- read_csv("data/epl_shooting_90.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel)) %>%
  select(-c(`Sh/90`, `SoT/90`))
epl_shooting_90

epl_shooting_max <- epl_shooting %>% 
  drop_na() %>%
  filter(`90s` >= 4) %>% 
  summarise_if(is.numeric, max)
epl_shooting_min <- epl_shooting %>% 
  drop_na() %>%
  filter(`90s` >= 4) %>%
  summarise_if(is.numeric, min) 

epl_shoot_player <- epl_shooting %>% filter(Name == "Marcus Rashford")



epl_shoot_half <- full_join(epl_shooting_min, epl_shoot_player)
epl_shoot_full <- full_join(epl_shooting_max, epl_shoot_half) %>%
  select(-c(Age, Squad, Pos, Nation, Name, Rk, Born, `90s`, FK, PKatt, PK))


radarchart(epl_shoot_full, pcol= "green", pfcol = rgb(0.2,0.5,0.5,0.75), 
            cglty = 1, axislabcol = "red", cglwd = 1,
           vlcex =0.8)


epl_shooting_90_max <- epl_shooting_90 %>% 
  drop_na() %>%
  filter(`90s` >= 4) %>% 
  summarise_if(is.numeric, max )
epl_shooting_90_min <- epl_shooting_90 %>% 
  drop_na() %>%
  filter(`90s` >= 4) %>%
  summarise_if(is.numeric, min) 

epl_shoot_90_player <- epl_shooting_90 %>% filter(Name == "Marcus Rashford")



epl_shoot_90_half <- full_join(epl_shooting_90_min, epl_shoot_90_player)
epl_shoot_90_full <- full_join(epl_shooting_90_max, epl_shoot_90_half) %>%
  select(-c(Age, Squad, Pos, Nation, Name, Rk, Born, `90s`, FK, PKatt, PK))


radarchart(epl_shoot_90_full, pcol= "green", pfcol = rgb(0.2,0.5,0.5,0.75), 
            cglty = 1, axislabcol = "red", cglwd = 1,
           vlcex =0.8)
```


```{r}
epl_passing <- read_csv("data/epl_passing.csv") %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_passing 

epl_passing_90 <- read_csv("data/epl_passing_90.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_passing_90 
```

```{r}
epl_passtype <- read_csv("data/epl_passtypes.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_passtype

epl_passtype_90 <- read_csv("data/epl_passtypes_90.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_passtype_90
```

```{r}
epl_goalandshotcreation <- read_csv("data/epl_goalandshotcreation.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_goalandshotcreation 

epl_goalandshotcreation_90 <- read_csv("data/epl_goalandshotcreation_90.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_goalandshotcreation_90 
```
 
```{r}
epl_passing_fill <- left_join(epl_passing, epl_passtype)
epl_passing_comb <- left_join(epl_passing_fill, epl_goalandshotcreation) %>%
  rename(`1/3` = `3-Jan`) %>%
  mutate(SCA_passes = SCA_PassLive + SCA_PassDead,
         GCA_passes = GCA_PassLive + GCA_PassDead)

epl_passing_main <- epl_passing_comb %>% 
  select(c(1:11, 14,16,17,19,20,22:28,30,35:38, 72,73))

epl_passing_main_max <- epl_passing_main %>% 
  drop_na() %>%
  filter(`90s` >= 4,
         Pos != "GK") %>% 
  summarise_if(is.numeric, max)
epl_passing_main_min <- epl_passing_main %>% 
  drop_na() %>%
  filter(`90s` >= 4,
         Pos != "GK") %>%
  summarise_if(is.numeric, min)

epl_pass_player <- epl_passing_main %>% filter(Name == "Kevin De Bruyne")

epl_pass_main_half <- full_join(epl_passing_main_min, epl_pass_player)

epl_pass_full <- full_join(epl_passing_main_max, epl_pass_main_half) %>%
  select(-c(Age, Squad, Pos, Nation, Name, Rk, Born, `90s`))

epl_pass_full %>% slice(0:2) %>%
  mutate(`A-xA` = fct_reorder(`A-xA`, `A-xA`))


radarchart(epl_pass_full, pcol= "green", pfcol = rgb(0.2,0.5,0.5,0.75), 
            cglty = 1, axislabcol = "red", cglwd = 1,
           vlcex =0.8)
```

```{r}
epl_defensiveactions <- read_csv("data/epl_defensiveactions.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_defensiveactions

epl_defensiveactions_90 <- read_csv("data/epl_defensiveactions_90.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_defensiveactions_90
``` 

```{r}
epl_possesion <- read_csv("data/epl_possesion.csv", skip = 1) %>%
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_possesion

epl_possesion_90 <- read_csv("data/epl_possesion_90.csv", skip = 1) %>%
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_possesion_90
```

```{r}
epl_miscellaneous <- read_csv("data/epl_miscellaneous.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_miscellaneous

epl_miscellaneous_90 <- read_csv("data/epl_miscellaneous_90.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_miscellaneous_90
```

```{r}
epl_goalkeeper <- read_csv("data/epl_goalkeeper.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_goalkeeper

epl_goalkeeper_90 <- read_csv("data/epl_goalkeeper_90.csv", skip = 1) %>% 
  select(-c(Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_goalkeeper_90
```

```{r}
epl_goalkeeperadvanced <- read_csv("data/epl_goalkeeperadvanced.csv", skip = 1) %>% 
  select(-c(3, Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_goalkeeperadvanced

epl_goalkeeperadvanced_90 <- read_csv("data/epl_goalkeeperadvanced_90.csv", skip = 1) %>% 
  select(-c(Matches)) %>%
  separate(Nation, into = c("irrel", "Nation"), sep = " ") %>%
  select(-c(irrel))
epl_goalkeeperadvanced_90
```
















```{r}
epl_standard_player <- epl_standard %>% filter(Name == "Max Aarons")

epl_standard_max <- epl_standard %>% summarise_if(is.numeric, max)
epl_standard_min <- epl_standard %>% summarise_if(is.numeric, min)

epl_standard_half <- full_join(epl_standard_min, epl_standard_player)
epl_standard_full <- full_join(epl_standard_max, epl_standard_half) %>%
  select(-c(Born, Name, Nation, Pos, Squad, Age))


radarchart(epl_standard_full, pcol= "green", pfcol = rgb(0.2,0.5,0.5,0.75), 
            cglty = 1, axislabcol = "red", cglwd = 1,
           vlcex =0.8)
```








```{r}
epl_standard_player <- epl_standard %>% filter(Name == "Ivan Toney" | Name == "Max Aarons") 

epl_standard_max <- epl_standard %>% summarise_if(is.numeric, max)
epl_standard_min <- epl_standard %>% summarise_if(is.numeric, min)

epl_standard_half <- full_join(epl_standard_min, epl_standard_player)
epl_standard_full <- full_join(epl_standard_max, epl_standard_half) %>%
  select(-c(Born, Name, Nation, Pos, Squad, Age))


radarchart(epl_standard_full)
```


```{r}
library(shiny)

ui <- fluidPage(
  sidebarLayout(sidebarPanel(
    selectizeInput("playerchoice",
                   label = "Choose a Player",
                   choices = levels(factor(epl_standard$Name)))
    
  ),
  mainPanel(plotOutput("radarChart"))
  )
)

server <- function(input, output, session) {
  
  epl_standard_player <- 
    reactive({
      epl_standard %>% filter(Name == input$playerchoice)
    })
  
  epl_standard_half <- 
    reactive({
      full_join(epl_standard_min, epl_standard_player())
    })
  
  epl_standard_full <- 
    reactive({
      full_join(epl_standard_max, epl_standard_half()) %>%
        select(-c(Born, Name, Nation, Pos, Squad, Age))
    })
  
  radar_chart <- 
    reactive({
      radarchart(epl_standard_full())
    })
  
  output$radarChart <- renderPlot({
    radar_chart()
  })
}

shinyApp(ui, server)

```






